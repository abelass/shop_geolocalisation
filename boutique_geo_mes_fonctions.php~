<?php

// redirection selon domaine et langue idée de http://www.spip-contrib.net/MultilinguismeExemple6

$cookie_lang=$_COOKIE['spip_lang'];	
echo $cookie_lang;

if(!$cookie_lang){

include_spip('inc/correspondances');

	$ip =$_SERVER['REMOTE_ADDR'];
	$ip='80.200.249.132';
	



	$a=get_country_by_ip($ip);

	preg_match("/\((.*?)\)/",$a['Country'],$match);

	
	$pays= $match[1];
	
echo $pays;


		$langues=pays_langue();
		
		$langue = $langues[$pays];
		
		echo $langue;
		
		//include_spip('inc/cookie');
		//spip_setcookie('spip_lang', $langue);		
	
		//$destination = parametre_url(self(),'lang', $langue, '&');

		include_spip('inc/headers');
		//redirige_par_entete($destination);

	}


// ip location


function get_country_by_ip($ip)
{

	$url='http://api.hostip.info/get_html.php?ip='.$ip.'&position=true';
 
	$data=file_get_contents($url);

	$a=array();
	$keys=array('Country','City','Latitude','Longitude','IP');
	$keycount=count($keys);
	for ($r=0; $r < $keycount ; $r++)
	{
		$sstr= substr ($data, strpos($data, $keys[$r]), strlen($data));
		if ( $r < ($keycount-1))
			$sstr = substr ($sstr, 0, strpos($sstr,$keys[$r+1]));
		$s=explode (':',$sstr);
		$a[$keys[$r]] = trim($s[1]);
	}
 
	return $a;
 
}
?>